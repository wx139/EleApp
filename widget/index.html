<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,initial-scale=1.0,width=device-width"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <link rel="stylesheet" type="text/css" href="./css/api.css" />
    <link rel="stylesheet" type="text/css" href="./css/aui.css" />
    <style type="text/css">
    html,body{
        height: 100%;background-image: url('./image/bj2.jpg');
    }

    .con{
		font-size: 28px;
		text-align: center;
	}
    </style>
</head>
<body>

</body>
<script type="text/javascript" src="./script/api.js"></script>
<script type="text/javascript">
    // var iflyRecognition;
    // var iflyRead;
    apiready = function(){

      api.addEventListener({
          name: 'keyback'
      }, function(ret, err) {
          return false
      });
      $api.setStorage('lasttag',0)
       $api.setStorage('url','http://122.112.167.37:8001/')
       $api.setStorage('ur','http://122.112.167.37:8001')
      // $api.setStorage('url','http://192.168.31.225:8080/')
      // $api.setStorage('ur','http://192.168.31.225:8080')
      // $api.setStorage('url','http://192.168.241.45:8000/')
      // $api.setStorage('ur','http://192.168.241.45:8000')


      // iflyRead=api.require('iflyRecognition');
      // iflyRead.createUtility({
      //     ios_appid: '5bc42c3d',
      //     android_appid: '5bc40ab1'
      // }, function(ret, err) {
      //     if (ret.status) {
      //         console.log({ msg: '创建成功'});
      //     } else {
      //         console.log({ msg: "创建失败" });
      //     }
      // });
      // iflyRecognition.createUtility({
      //     ios_appid: '5bc42c3d',
      //     android_appid: '5bc40ab1'
      // }, function(ret, err) {
      //     if (ret.status) {
      //         console.log({ msg: '创建成功'});
      //     } else {
      //         console.log({ msg: "创建失败" });
      //     }
      // });

      //iflylisten();

       if($api.getStorage('bg')==''||$api.getStorage('bg')==undefined) {
         $api.setStorage('bg','../image/bj/bj14.jpg')
       }
      // 设置内容页
      if($api.getStorage('token')==''||$api.getStorage('token')==undefined) {
        api.openWin({
            name: 'login',
            url: 'html/log/login.html',

        });
        return;
      }
      api.openFrameGroup({
          name: 'main',
          rect: {
              x: 0,
              y: 0,
              w: 'auto',
              h: api.frameHeight-50
          },
          index:0,
          scrollEnabled:false,
          preload:5,
          frames: [{
              name: 'zhuye',
              url: 'html/zhuye.html',
              bgColor: '#fff'
          }, {
              name: 'shebei',
              url: 'html/shebei.html',
              bgColor: '#fff'
          }, {
              name: 'fenxi',
              url: 'html/fenxi.html',
              bgColor: '#fff'
          }, {
              name: 'kongzhi',
              url: 'html/kongzhi.html',
              bgColor: '#fff'
          }, {
              name: 'shezhi',
              url: 'html/shezhi.html',
              bgColor: '#fff'
          }]
      }, function(ret, err) {
          var index = ret.index;

      });

  //底部导航栏
  var NVTabBar = api.require('NVTabBar');
  NVTabBar.open({
      styles: {
          bg: '#fff',
          h: 55,
          dividingLine: {
              width: 0,
              color: '#000'
          },
          badge: {
              bgColor: '#ff0',
              numColor: '#fff',
              size: 6.0,
              centerX: 40,
              centerY: 6
          }
      },
      items: [{
          w: api.winWidth / 5.0,
          bg: {
              marginB: 0,
              image: 'rgba(225,225,225,0.6)'
          },
          iconRect: {
              w: 25.0,
              h: 25.0,
          },
          icon: {
              normal: 'widget://image/icon_normal/zhuye.png',
              highlight: 'widget://image/NVTabBar/actied.png',
              selected: 'widget://image/icon_blue/zhuye.png'
          },
          title: {
              text: '主页',
              size: 12.0,
              normal: '#696969',
              selected: '#5487d7',
              marginB: 6.0
          }
          }, {
            w: api.winWidth / 5.0,
            bg: {
                marginB: 0,
                image: 'rgba(225,225,225,0.6)'
            },
            iconRect: {
                w: 25.0,
                h: 25.0,
            },
            icon: {
                normal: 'widget://image/icon_normal/shebei.png',
                highlight: 'widget://image/NVTabBar/guaned.png',
                selected: 'widget://image/icon_blue/shebei.png'
            },
            title: {
                text: '设备',
                size: 12.0,
                normal: '#696969',
                selected: '#5487d7',
                marginB: 6.0
            }
        }, {
            w: api.winWidth / 5.0,
            bg: {
                marginB: 0,
                image: 'rgba(225,225,225,0.6)'//中间背景图
            },
            iconRect: {
                w: 25,
                h: 25,
            },
            icon: {
                normal: 'widget://image/icon_normal/fenxi.png',
                highlight: 'widget://image/NVTabBar/mai.png',
                selected: 'widget://image/icon_blue/fenxi.png'
            },
            title: {
                text : '分析',
                size: 12.0,
                normal: '#696969',
                selected: '#5487d7',
                marginB: 6
            }
        }, {
            w: api.winWidth / 5.0,
            bg: {
                marginB: 0,
                image: 'rgba(225,225,225,0.6)'
            },
            iconRect: {
                w: 25.0,
                h: 25.0,
            },
            icon: {
                normal: 'widget://image/icon_normal/kongzhi.png',
                highlight: 'widget://image/NVTabBar/faved.png',
                selected: 'widget://image/icon_blue/kongzhi.png'
            },
            title: {
                text: '控制',
                size: 12.0,
                normal: '#696969',
                selected: '#5487d7',
                marginB: 6.0
            }
        }, {
            w: api.winWidth / 5.0,
            bg: {
                marginB: 0,
                image: 'rgba(225,225,225,0.6)'
            },
            iconRect: {
                w: 25.0,
                h: 25.0,
            },
            icon: {
                normal: 'widget://image/icon_normal/shezhi.png',
                highlight: 'widget://image/NVTabBar/bired.png',
                selected: 'widget://image/icon_blue/shezhi.png'
            },
            title: {
                text: '设置',
                size: 12.0,
                normal: '#696969',
                selected: '#5487d7',
                marginB: 6.0
            }
        }],
      selectedIndex: 0
  }, function(ret, err) {
    if(ret.index==undefined){
      return;
    }
    // stoplisten($api.getStorage('lasttag'))
    // // console.log(ret.index);
    // startlisten(ret.index)
    $api.setStorage('lasttag',ret.index)
    api.setFrameGroupIndex({
      name: 'main',
      index: ret.index
    });
  });
}

// function startlisten(index){
//   if(index==0){
//     api.execScript({
//         frameName: 'zhuye',
//         script: 'startlisten()'
//     });
//   }else if (index==1) {
//     api.execScript({
//         frameName: 'shebei',
//         script: 'startlisten()'
//     });
//   }else if (index==2) {
//     api.execScript({
//         frameName: 'fenxi',
//         script: 'startlisten()'
//     });
//   }else if (index==3) {
//     api.execScript({
//         frameName: 'kongzhi',
//         script: 'startlisten()'
//     });
//   }else if (index==4) {
//     api.execScript({
//         frameName: 'shezhi',
//         script: 'startlisten()'
//     });
//   }
// }

// function iflylisten(){
//   console.log('dsd');
//   iflyRecognition.record({
//       vadbos: 1500,
//       vadeos: 1500,
//       rate: 16000,
//       asrptt: 0,
//   }, function(ret, err) {
//       if (ret.status) {
//         if (ret.wordStr != '' && ret.wordStr != null) {
//           //console.log(ret.wordStr.toString());
//         }
//         if(ret.wordStr.indexOf('打开') > -1){
//           var sbname;
//           sb=ret.wordStr.split('打开')
//           if(sb[0]==''&&sb[1]!=''){
//             sbname=sb[1]
//           }else if(sb[0]!=''&&sb[1]=='')
//           {
//             sbname=sb[0]
//           }
//           else{
//             return
//           }
//           console.log($api.getStorage('url')+'searchnickname/?userid='+$api.getStorage('userid')+'&nickname='+sbname);
//           api.ajax({
//               url: $api.getStorage('url')+'searchnickname/?userid='+$api.getStorage('userid')+'&nickname='+sbname,
//               method: 'get',
//           }, function(ret, err) {
//               if(ret==undefined||ret==null||ret==''||ret.length==0)
//               {
//                 readword('没有找到这个设备')
//               }
//               if (ret) {
//                   if(ret==undefined||ret==null||ret==''||ret.length==0)
//                   {
//                     readword('没有找到这个设备')
//                   }
//                   else{
//                     api.ajax({
//                       url: $api.getStorage('url')+'switchequ/?equNumber='+ret[0]+'&number='+ret[1]+'&switch=open',
//                         method: 'get',
//                     },
//                     function(ret, err) {
//                         if (ret) {
//                             console.log(JSON.stringify(ret));
//                             readword(' '+'已成功打开'+sbname+'   ')
//
//                         } else {
//                           console.log(JSON.stringify(err));
//                           readword('打开'+sbname+'失败')
//                         }
//                     });
//                   }
//               } else {
//                   console.log(JSON.stringify(err));
//               }
//           });
//         }
//         if(ret.wordStr.indexOf('关闭') > -1){
//           var sbname;
//           sb=ret.wordStr.split('关闭')
//           if(sb[0]==''&&sb[1]!=''){
//             sbname=sb[1]
//           }else if(sb[0]!=''&&sb[1]=='')
//           {
//             sbname=sb[0]
//           }
//           else{
//             return
//           }
//           console.log($api.getStorage('url')+'searchnickname/?userid='+$api.getStorage('userid')+'&nickname='+sbname);
//           api.ajax({
//               url: $api.getStorage('url')+'searchnickname/?userid='+$api.getStorage('userid')+'&nickname='+sbname,
//               method: 'get',
//           }, function(ret, err) {
//               if(ret==undefined||ret==null||ret==''||ret.length==0)
//               {
//                 readword('没有找到这个设备')
//               }
//               if (ret) {
//                   if(ret.length==0)
//                   {
//                     readword('没有找到这个设备')
//                   }
//                   else{
//                     api.ajax({
//                       url: $api.getStorage('url')+'switchequ/?equNumber='+ret[0]+'&number='+ret[1]+'&switch=close',
//                         method: 'get',
//                     },
//                     function(ret, err) {
//                         if (ret) {
//                             console.log(JSON.stringify(ret));
//                             readword(' '+'已成功关闭'+sbname+' ')
//                         } else {
//                           console.log(JSON.stringify(err));
//                           readword('关闭'+sbname+'失败')
//                         }
//                     });
//                   }
//               } else {
//                   console.log(JSON.stringify(err));
//               }
//           });
//         }
//         else {
//           iflylisten();
//           return;
//         }
//         console.log(ret.wordStr.toString());
//         iflylisten();
//         return;
//       } else {
//         iflylisten();
//         return;
//       }
//   });
// }


// function readword(word){
//   iflyRecognition.read({
//       readStr: '    '+word,
//       speed: 40,
//       volume: 100,
//       voice: 1,
//       rate: 16000,
//   }, function(ret, err) {
//       if (ret.status) {
//           if(ret.speakProgress==100){
//             iflylisten()
//           }
//
//       } else {
//           api.alert({ msg: err.msg });
//           iflylisten()
//       }
//   });
// }
//
// function stoplisten(index){
//   if(index==0){
//     api.execScript({
//         frameName: 'zhuye',
//         script: 'stoplisten()'
//     });
//   }else if (index==1) {
//     api.execScript({
//         frameName: 'shebei',
//         script: 'stoplisten()'
//     });
//   }else if (index==2) {
//     api.execScript({
//         frameName: 'fenxi',
//         script: 'stoplisten()'
//     });
//   }else if (index==3) {
//     api.execScript({
//         frameName: 'kongzhi',
//         script: 'stoplisten()'
//     });
//   }else if (index==4) {
//     api.execScript({
//         frameName: 'shezhi',
//         script: 'stoplisten()'
//     });
//   }
// }

</script>
</html>
